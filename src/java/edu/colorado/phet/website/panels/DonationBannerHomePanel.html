<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd" xml:lang="en"
      lang="en">
<head>
    <title>[PREVIEW] DonationBannerHomePanel</title>
    <wicket:remove>
        <link rel="stylesheet" type="text/css" href="../../../../../../../root/css/preview.css"/>
    </wicket:remove>
</head>
<body>

<wicket:panel>
    <div style="height: 164px;">
        <div id="donation-rotator" style="width: 192px; height: 144px; overflow: hidden; position: relative;">
            <div id="donation0" class="donation-rotator-image">
                <img src="/images/banner-rotation/CIMG3209-192x144.png" alt="PhET in Burundi" width="192"
                     height="144"/>
                <div>Burundi</div>
            </div>
            <div id="donation1" class="donation-rotator-image start-off-screen">
                <img src="/images/banner-rotation/CaoSesen1_Vietnam-192x144.png" alt="PhET in Vietnam"
                     width="192" height="144"/>
                <div>Vietnam</div>
            </div>
            <div id="donation2" class="donation-rotator-image start-off-screen">
                <img src="/images/banner-rotation/DavidDionys_Cambodia-192x144.png" alt="PhET in Cambodia"
                     width="192" height="144"/>
                <div>Cambodia</div>
            </div>
            <div id="donation3" class="donation-rotator-image start-off-screen">
                <img src="/images/banner-rotation/Podolefsky_Dallas4-192x144.png" alt="PhET in the US"
                     width="192" height="144"/>
                <div>United States</div>
            </div>
        </div>
        <script type="text/javascript">
            (function() {
                var width = 192;
                var height = 144;
                var quantity = 4;

                /**
                 * The index into the preview array that represents the preview currently in focus. The animation will slide until
                 * this preview takes up the entire rotator.
                 */
                var idx = 0;

                /**
                 * The index into the preview array for the preview that has the focus at load time
                 */
                var startIdx = 0;

                /**
                 * The current offset (in pixels) of the desired slide position from the current slide position.
                 */
                var offset = 0;

                var framesBetweenSwitch = 5 * 30; // * 30 since 30 frames a second. needs to be an integral number

                /**
                 * Sliding-model velocity so we can do smooth animation
                 */
                var velocity = 0;

                var totalWidth = width * quantity;

                function nextIdx( i ) {
                    return (i + 1) < quantity ? i + 1 : 0;
                }

                var counter = 0;
                setInterval( function() {
                    counter++;

                    if ( counter % framesBetweenSwitch == 0 ) {
                        // switch to the next image
                        idx = nextIdx( idx );
                        offset += width;
                    }

                    if ( offset == 0 ) {
                        return;
                    }

                    // do some math that is mostly an over-damped oscillator but near the target is weighted with something else
                    // copied somewhat from the ActionScript version in Rotator.as

                    var c0 = 0.2;
                    var c1 = 0.015;
                    var a = -c0 * velocity - c1 * offset;
                    var bounce = velocity + 0.5 * a;
                    velocity += a;

                    var minv = 5;
                    var slide = 50;
                    if ( Math.abs( offset ) < slide ) {
                        // how much weight to give to the stabilizer
                        var frac = Math.abs( offset ) / slide;
                        if ( frac < 0 ) { frac = 0; }
                        bounce *= 2 - frac;
                    }
                    if ( Math.abs( offset ) < minv ) {
                        bounce = -offset;
                    }

                    offset += bounce;

                    for ( var i = 0; i < quantity; i++ ) {
                        var preview = document.getElementById( 'donation' + i );
                        var x = ((i - idx) * width + offset) % totalWidth;
                        if ( x < 0 ) { x += totalWidth; }
                        if ( totalWidth - x < width ) {
                            x -= totalWidth;
                        }
                        if ( x < width ) {
                            preview.style.left = x + "px";
                            preview.style.display = "block"; // make it visible
                        }
                        else {
                            // hide it
                            preview.style.left = "5000px";
                            preview.style.display = "none";
                        }
                    }
                }, 33 )
            })();
        </script>
        <div class="donation-header">PhET's Annual Campaign</div>
        <p class="donation-text">
            Donate to advance science literacy and education worldwide<br/>
            25 million uses per year, 65 languages, and growing
        </p>

        <form id="donation-button-form" method="get" target="#">
            <input type="button" value="Donate now" class="large-form-button"
                   onclick="document.location='http://www.cufund.org/giving-opportunities/fund-description/?id=7397'"/>
        </form>
    </div>
</wicket:panel>

</body>
</html>

